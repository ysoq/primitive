<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Image</title>
</head>

<body>
    <h1>Upload Image</h1>
    <form id="uploadForm" enctype="application/x-www-form-urlencoded">
        <label for="imageInput">选择图片:</label>
        <input type="file" id="imageInput" name="image" accept="image/*" required><br><br>

        <label for="stepCountInput">复杂度 (stepCount):</label>
        <input type="number" id="stepCountInput" name="stepCount" value="200" min="1" max="1000" required><br><br>

        <label for="imageTypeInput">创造类型:</label>
        <select id="imageTypeInput" name="imageType" required>
            <option value="png">PNG</option>
            <option value="svg">SVG</option>
            <option value="gif">GIF</option>
        </select><br><br>

        <button type="button" onclick="uploadImage()">开始创作</button>
    </form>

    <div id="responseArea"></div>

    <script>
        function uploadImage() {
            const imageInput = document.getElementById('imageInput');
            const stepCountInput = document.getElementById('stepCountInput');
            const imageTypeInput = document.getElementById('imageTypeInput');

            if (imageInput.files.length === 0) {
                alert('Please select an image to upload.');
                return;
            }

            const file = imageInput.files[0];
            const reader = new FileReader();

            reader.onload = function (event) {
                const base64String = event.target.result.split(',')[1];

                fetch('/process', { // Assuming your server endpoint is '/upload'
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: 'image=' + encodeURIComponent(base64String) + '&stepCount=' + stepCountInput.value + '&imageType=' + imageTypeInput.value
                })
                    .then(response => response.json())
                    .then(data => {
                        if (imageTypeInput.value == "gif" || imageTypeInput.value == "png") {
                            // Assuming the server returns a JSON object with an 'image' property containing the URL of the processed image
                            var imgElement = document.createElement('img');
                            imgElement.src = ("data:image/" + imageTypeInput.value + ";base64," + data.data);
                            imgElement.alt = 'Processed Image';
                            imgElement.style.maxWidth = '100%'; // Optional: Set a maximum width for the image
                            const responseArea = document.getElementById('responseArea');
                            responseArea.innerHTML = ''; // Clear previous content
                            responseArea.appendChild(imgElement);
                        } else if (imageTypeInput.value == "svg") {
                            const responseArea = document.getElementById('responseArea');
                            responseArea.innerHTML = data.data;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while uploading the image.');
                    });
            };

            reader.onerror = function (error) {
                console.error('Error reading file:', error);
                alert('An error occurred while reading the file.');
            };

            // Read the file as a Data URL (Base64 encoded string)
            reader.readAsDataURL(file);
        }
    </script>
</body>

</html>